<!DOCTYPE html>
<html>
  <head>
    <title>Palestine Online</title>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" href="public/98.css" />
    <link rel="stylesheet" href="public/style.css" />
    <link rel="preconnect" href="https://web.archive.org">

    <link rel="preload" href="/images/bg-min.png" as="image">
    <link rel="preload" href="/images/bg-min.png" as="image">

    <link rel="preload" href="/public/tiles/keffiyeh-dithered.gif" as="image">
    <link rel="preload" href="/public/tiles/aqwa-man-tile-bg.jpg" as="image">
    <link rel="preload" href="/public/tiles/arabic-html-tutorial-tile-bg.jpg" as="image">
    <link rel="preload" href="/public/tiles/hadisoft-tile-bg.jpeg" as="image">
    <link rel="preload" href="/public/tiles/jukebox-arabia-tile-bg.gif" as="image">

    <link rel="preload" href="/public/tiles/lina-online-tile-bg.GIF" as="image">
    <link rel="preload" href="/public/tiles/nidal-jayyousi-tile-bg.jpg" as="image">
    <link rel="preload" href="/public/tiles/palestine-youth-union-tile-bg.jpg" as="image">
    <link rel="preload" href="/public/tiles/people-of-palestine-tile-bg.gif" as="image">
    <link rel="preload" href="/public/tiles/zuhair-tile-bg.gif" as="image">

    <link rel="preload" href="/public/tiles/rani-tile-bg.jpg" as="image">
    <link rel="preload" href="/public/tiles/samia-halaby-1-tile-bg.gif" as="image">
    <link rel="preload" href="/public/tiles/sharabati-tile-bg.JPG" as="image">
    <link rel="preload" href="/public/tiles/pals2.gif" as="image">
    <link rel="preload" href="/public/tiles/back.jpg" as="image">

    <link rel="preload" href="/public/tiles/back4.jpg" as="image">
    <link rel="preload" href="/public/tiles/hanthbg.gif" as="image">
    <link rel="preload" href="/public/tiles/cloudtil.jpg" as="image">
    <link rel="preload" href="/public/tiles/welcome.gif" as="image">
    <link rel="preload" href="/public/tiles/back.jpg" as="image">

    <script src="src/functions.js"></script>
  </head>

  <body onload="setFramePage()">
    <button class="mobile-share-alert">
      Page Link copied to clipboard.
    </button>
    <div id="mobile-dropdown-content" class="dropdown-content">
      <ul class="tree-view" id="tree"></ul>
    </div>
    <button class="mobile-top-nav">
      <div class="address-bar">
        <div id="address-bar-text">
          Samia Halaby's site
        </div>
      </div>
      <img class="mobile-nav-folder" src="public/directory_closed_cool-4.svg" onclick="dropdownContent.classList.toggle('open');" />
    </button>
    <div class="mobile-buttons-grid" id="mobile-nav">
      <button id="zoomSlider">
        <div class="field-row">
          <label id="mobile-zoom-out" class="slider-label">-</label>
          <input id="zoom-slider" step="any" onchange="changeZoom(this.value)" id="range26" type="range" min="1" max="21" value="11" />
          <label class="slider-label" id="mobile-zoom-in">+</label>
        </div>
      </button>
      <button class="mobile-button">
        <img class="mobile-button-graphic" src="public/back.svg" height="30px" onclick="window.history.back()" />
      </button>
      <button class="mobile-button">
        <img class="mobile-button-graphic" src="public/front.svg" height="30px" onclick="window.history.forward()" />
      </button>
      <button class="mobile-button">
        <img class="mobile-button-graphic" height="30px" src="public/icons/envelope_closed-1.svg" onclick="shareSite('mobile')"/>
      </button>
      <button class="mobile-button">
        <img class="mobile-button-graphic" height="30px" src="public/netmeeting-1.svg" onclick="setFramePage(true)" />
      </button>
      <button class="mobile-button">
        <img class="mobile-button-graphic" height="30px" src="public/icons/help_book_small-5.svg" onclick="setRandomPage()"/>
      </button>
    </div>
    <div class="window-grid" id="window">
      <div class="info-panel-container" id="info-panel-container" style="visibility: hidden">
        <div class="notes-header">Page Information</div>
        <div class="close-info-panel-button">
          <div class="title-bar-controls">
            <button class="notes-close-button" style="zoom: 1.4" aria-label="Close"></button>
          </div>
        </div>
      </div>
      <div class="window walkthru-window">
        <div class="title-bar">
          <div class="title-bar-text">
            Palestine Online
          </div>
        </div>
        <div class="window-body" style="margin: 0px; overflow: hidden;">
          <section style="margin: 6px 8px 4px 8px" class="field-row" style="justify-content: flex-start">
            <a class="tooltip">
              <input type="image" onclick="window.history.back()" src="public/back.svg" height="24px"
                style="margin-bottom: 2px" />
              <span class="tooltiptext">Go Back</span>
            </a>
            <a class="tooltip">
              <input type="image" onclick="window.history.forward()" src="public/front.svg" height="24px"
                style="margin-bottom: 2px" />
              <span class="tooltiptext">Go Forward</span>
            </a>
            <div class="divider">|</div>
            <a class="tooltip">
              <input style="opacity: 1; cursor: pointer" type="image" src="public/home.svg" height="25px" onclick="" />
              <span class="tooltiptext">Go to Homepage</span>
            </a>
            <a class="tooltip">
              <input type="image" src="public/icons/help_book_small-5.svg" height="25px" onclick="setRandomPage()" />
              <span class="tooltiptext">Go to random site</span>
            </a>
            <a class="tooltip">
              <input style="opacity: 1; cursor: pointer" type="image" src="public/netmeeting-1.svg" height="25px" onclick="setFramePage(true)" />
              <span class="tooltiptext">Reset current site</span>
            </a>
            <a class="tooltip">
            </a>
            <div class="dropdown-container">
              <pre id="current-site">
                </pre>
              <a class="tooltip">
                <div class="dropdown">
                </div>
                <span class="tooltiptext tooltip-address-bar">View websites</span>
              </a>
              <div id="dropdown-content" class="dropdown-content">
                <ul class="tree-view" id="tree-original"></ul>
              </div>
            </div>
            <a class="tooltip">
              <input type="image" onclick="setWallpaper()" src="public/icons/info.svg" height="25px" />
              <span class="tooltiptext tooltip-right">Information</span>
            </a>
            <a class="tooltip">
              <input type="image" onclick="shareSite()" src="public/icons/envelope_closed-1.svg" height="25px" />
              <span id="share-page-tooltip" class="tooltiptext tooltip-right">Share Page</span>
            </a>
          </section>
          <iframe id="menu" title="Menu" width="100%" src=""
            style="position: absolute; width: 0; height: 0; border: 0; border: none; position: absolute; overflow-y: hidden; background-color: silver;"></iframe>
          <div id="frame-container">
            <div id="loading" style="
            position: absolute;
            display: none;
            margin-bottom: auto; 
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);"  >
              <img style="height: 50px;" src="public/loading4.gif"/>
            </div>  
            <iframe id="frame" title="Frame" width="99.5%" src="">
            </iframe>
          </div>
        </div>
        <div id="breadcrumbs" class="status-bar">
        </div>
      </div>
    </div>
    </div>
    <script>

      const mobileZoomOut = document.getElementById('mobile-zoom-out');
      const mobileZoomIn = document.getElementById('mobile-zoom-in');
      const zoomSlider = document.getElementById('zoom-slider');
      let zoomValue;

      let addressBar = document.querySelector(".address-bar");
      addressBar.disabled = true;

      let sliderButton = document.getElementById("zoomSlider");
      sliderButton.disabled = true;

      let mobileShareAlert = document.querySelector(".mobile-share-alert");
      mobileShareAlert.disabled = true;

      mobileZoomOut.addEventListener('touchstart', () => {
        zoomSlider.value -= 1;
        changeZoom(zoomSlider.value)
      });

      mobileZoomIn.addEventListener('touchstart', () => {
        zoomSlider.value++;
        changeZoom(zoomSlider.value)
      });

      // change wallpaper on click of page body  
      document.body.addEventListener('click', function (event) {
        setWallpaper();
      });
      // but not window
      document.querySelector('.window-grid').addEventListener('click', function (event) {
        event.stopPropagation();
      });

      // adjust dropdown size based on flex address bar
      document.querySelector('#current-site').addEventListener('click', function () {
        const dropdownContent = document.querySelector('#dropdown-content');
        dropdownContent.style.width = `${document.querySelector('.dropdown-container').offsetWidth - 2}px`;
        dropdownContent.classList.toggle('open');
      });

      // add event listener to dropdown bar and button
      document.querySelector('.dropdown').addEventListener('click', function () {
        const dropdownContent = document.querySelector('#dropdown-content');
        dropdownContent.style.width = `${document.querySelector('.dropdown-container').offsetWidth - 3}px`;
        dropdownContent.classList.toggle('open');
      });

      document.querySelector('.mobile-top-nav').addEventListener('click', function () {
        const dropdownContent1 = document.querySelector('#mobile-dropdown-content');
        dropdownContent1.classList.toggle('open');
      });

      const treeViewContainer = document.getElementById('tree');
      const treeViewContainerOriginal = document.getElementById('tree-original');

      // Create the tree view from the data object and append it to the container
      treeViewContainer.appendChild(createTreeView(siteTree));
      treeViewContainerOriginal.appendChild(createTreeView(siteTree));
      
      document.getElementById('frame').onload = function () {
        changeZoom(zoomValue);
      }

      function shareSite(mode = 'desktop') {
  console.log('share site');
  const scrollPosition = document.getElementById('frame').contentWindow.scrollY;

  let dummy = document.createElement('input'),
  windowLocation = (window.location.href).replace(/&page=.*$/, '');
  // const iframe = document.getElementById('frame')
  
  const regex = /\/sites\/(.*)/;
  
  // console.log('path', document.getElementById("frame").contentWindow.location.href);

  const path = (document.getElementById("frame").contentWindow.location.href).match(regex)[1];
  console.log('path', path);
  windowLocation += `&page=${path}`;
  document.body.appendChild(dummy);
  dummy.value = windowLocation;
  dummy.select();
  document.execCommand('copy');
  document.body.removeChild(dummy);

  const tooltip = document.getElementById('share-page-tooltip');
  tooltip.innerHTML = 'Link copied.';

  if (mode === 'desktop') {
    setTimeout(() => tooltip.innerHTML = 'Share Page' , 2500)
  }
  if (mode = 'mobile') {
    mobileShareAlert.style.visibility = 'visible';
    setTimeout(() => mobileShareAlert.style.visibility = 'hidden', 2500)
  }
};
    </script>
  </body>
</html>
